{% extends "base.html" %}

{% block topbar_actions %}
  <a class="btn btn-secondary" href="{{ url_for('agents.view_script', script_id=script.id) }}">
    <i class="fa-solid fa-arrow-left"></i>
    back to script
  </a>
  <a class="btn btn-secondary" href="{{ url_for('agents.list_scripts') }}">
    <i class="fa-solid fa-list"></i>
    all scripts
  </a>
{% endblock %}

{% block content %}
<section class="card">
  <div class="card-header">
    <div>
      <p class="eyebrow">script {{ script.id }}</p>
      <h2 class="section-title">Edit Script</h2>
    </div>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Update file metadata and content. Uploading a file overrides the content field.
  </p>
  <p class="muted" style="margin-top: 8px; font-size: 12px;">
    Stored path: {{ script.file_path or "-" }}
  </p>
  <form
    method="post"
    action="{{ url_for('agents.update_script', script_id=script.id) }}"
    class="form-grid"
    enctype="multipart/form-data"
    style="margin-top: 20px;"
  >
    <label class="label">
      file name
      <input type="text" name="file_name" value="{{ script.file_name }}" class="input" />
    </label>
    <label class="label">
      script type
      <select name="script_type" class="input">
        {% for value, label in script_types %}
          <option value="{{ value }}" {% if script.script_type == value %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </label>
    <label class="label">
      description (optional)
      <input
        type="text"
        name="description"
        value="{{ script.description or '' }}"
        class="input"
      />
    </label>
    <label class="label">
      upload file (optional)
      <input type="file" name="script_file" class="input" />
      <span class="muted" style="font-size: 12px; margin-top: 6px;">
        Uploading overrides the content field below.
      </span>
    </label>
    <label class="label">
      script content
      <textarea name="content" class="textarea">{{ script_content }}</textarea>
    </label>
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <i class="fa-solid fa-floppy-disk"></i>
        save
      </button>
      <a class="btn btn-secondary" href="{{ url_for('agents.view_script', script_id=script.id) }}">
        <i class="fa-solid fa-arrow-left"></i>
        cancel
      </a>
    </div>
  </form>
</section>
{% endblock %}
