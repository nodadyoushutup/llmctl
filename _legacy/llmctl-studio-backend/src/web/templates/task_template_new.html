{% extends "base.html" %}

{% block topbar_actions %}
  <a class="btn btn-secondary" href="{{ url_for('agents.list_task_templates') }}">
    <i class="fa-solid fa-arrow-left"></i>
    back to tasks
  </a>
{% endblock %}

{% block content %}
<section class="card">
  <div class="card-header">
    <h2 class="section-title">Create Task</h2>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Tasks are reusable definitions executed by flowchart task nodes. Agents can be assigned later.
  </p>
  <form method="post" action="{{ url_for('agents.create_task_template') }}" class="form-grid" enctype="multipart/form-data">
    <label class="label">
      name
      <input type="text" name="name" placeholder="Draft plan" class="input" />
    </label>
    <label class="label">
      description (optional)
      <input
        type="text"
        name="description"
        placeholder="Short intent"
        class="input"
      />
    </label>
    <label class="label">
      agent
      <select name="agent_id" class="input">
        <option value="">No agent (optional)</option>
        {% for agent in agents %}
          <option value="{{ agent.id }}">{{ agent.name }}</option>
        {% endfor %}
      </select>
      {% if not agents %}
        <span class="muted" style="font-size: 12px; margin-top: 6px;">
          Create an agent when you want to attach one.
        </span>
      {% endif %}
    </label>
    <label class="label" style="grid-column: 1 / -1;">
      prompt
      <textarea
        name="prompt"
        placeholder="Write the plan for the next milestone."
        class="textarea"
        data-attachment-paste
        data-attachment-input-id="template-attachments-new"
      ></textarea>
    </label>
    <label class="label" style="grid-column: 1 / -1;">
      attachments (optional)
      <input
        type="file"
        name="attachments"
        id="template-attachments-new"
        class="input"
        multiple
        data-attachment-input
      />
      <span class="muted" style="font-size: 12px; margin-top: 6px;">
        Paste images into the prompt or choose files. Saved to <code>data/attachments</code>.
      </span>
      <div class="muted" style="font-size: 12px; margin-top: 6px;" data-attachment-list="template-attachments-new"></div>
    </label>
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <i class="fa-solid fa-plus"></i>
        create task
      </button>
      <a class="btn btn-secondary" href="{{ url_for('agents.list_task_templates') }}">
        <i class="fa-solid fa-arrow-left"></i>
        back to tasks
      </a>
    </div>
  </form>
</section>
{% endblock %}
