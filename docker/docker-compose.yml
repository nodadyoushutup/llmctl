services:
  redis:
    image: redis:7.2-alpine
    command: ["redis-server", "--appendonly", "yes", "--port", "6380"]
    dns:
      - 192.168.1.1
      - 1.1.1.1
      - 8.8.8.8
    ports:
      - "6380:6380"
  github-mcp:
    build:
      context: ..
      dockerfile: app/llmctl-mcp/docker/github-mcp-proxy.Dockerfile
    container_name: github-mcp
    environment:
      - GITHUB_PERSONAL_ACCESS_TOKEN=${GITHUB_PERSONAL_ACCESS_TOKEN}
      - GITHUB_HOST=${GITHUB_HOST:-}
    dns:
      - 192.168.1.1
      - 1.1.1.1
      - 8.8.8.8
    entrypoint: ["/bin/busybox", "sleep", "infinity"]
    restart: unless-stopped
  jira-mcp:
    image: ghcr.io/sooperset/mcp-atlassian:latest
    container_name: jira-mcp
    environment:
      - JIRA_URL=${JIRA_URL}
      - JIRA_USERNAME=${JIRA_USERNAME}
      - JIRA_API_TOKEN=${JIRA_API_TOKEN}
      - CONFLUENCE_URL=${CONFLUENCE_URL}
      - CONFLUENCE_USERNAME=${CONFLUENCE_USERNAME}
      - CONFLUENCE_API_TOKEN=${CONFLUENCE_API_TOKEN}
    dns:
      - 192.168.1.1
      - 1.1.1.1
      - 8.8.8.8
    entrypoint: ["sleep", "infinity"]
    restart: unless-stopped
  chromadb-mcp:
    image: llmctl-chromadb-mcp:latest
    build:
      context: ..
      dockerfile: app/llmctl-mcp/docker/chromadb-mcp-proxy.Dockerfile
    container_name: chromadb-mcp
    environment:
      - CHROMA_CLIENT_TYPE=${CHROMA_CLIENT_TYPE:-http}
      - CHROMA_HOST=${CHROMA_HOST:-chromadb}
      - CHROMA_PORT=${CHROMA_PORT:-8000}
      - CHROMA_SSL=${CHROMA_SSL:-false}
    dns:
      - 192.168.1.1
      - 1.1.1.1
      - 8.8.8.8
    entrypoint: ["sleep", "infinity"]
    depends_on:
      - chromadb
    restart: unless-stopped
  llmctl-mcp:
    image: llmctl-mcp:latest
    build:
      context: ..
      dockerfile: app/llmctl-mcp/docker/llmctl-mcp.Dockerfile
    container_name: llmctl-mcp
    environment:
      - LLMCTL_MCP_HOST=0.0.0.0
      - LLMCTL_MCP_PORT=${LLMCTL_MCP_PORT:-9020}
      - LLMCTL_MCP_PATH=${LLMCTL_MCP_PATH:-/mcp}
      - LLMCTL_MCP_TRANSPORT=${LLMCTL_MCP_TRANSPORT:-stdio}
      - LLMCTL_STUDIO_DATA_DIR=/app/data
      - CELERY_REDIS_HOST=${CELERY_REDIS_HOST:-192.168.1.36}
      - CELERY_REDIS_PORT=${CELERY_REDIS_PORT:-6380}
      - CELERY_REDIS_BROKER_DB=${CELERY_REDIS_BROKER_DB:-0}
      - CELERY_REDIS_BACKEND_DB=${CELERY_REDIS_BACKEND_DB:-1}
    dns:
      - 192.168.1.1
      - 1.1.1.1
      - 8.8.8.8
    entrypoint: ["sleep", "infinity"]
    volumes:
      - ../data:/app/data
      - ../app/llmctl-mcp:/app/app/llmctl-mcp
      - ../app/llmctl-studio/src:/app/app/llmctl-studio/src
    restart: unless-stopped
  chromadb:
    image: chromadb/chroma:latest
    container_name: chromadb
    environment:
      - IS_PERSISTENT=TRUE
      - ANONYMIZED_TELEMETRY=FALSE
    dns:
      - 192.168.1.1
      - 1.1.1.1
      - 8.8.8.8
    ports:
      - "8000:8000"
    volumes:
      - chroma_data:/chroma/chroma
    restart: unless-stopped
  llmctl-rag:
    build:
      context: ..
      dockerfile: app/llmctl-rag/docker/llmctl-rag.Dockerfile
    container_name: llmctl-rag
    environment:
      - CELERY_REDIS_HOST=${CELERY_REDIS_HOST:-192.168.1.36}
      - CELERY_REDIS_PORT=${CELERY_REDIS_PORT:-6380}
      - CELERY_REDIS_BROKER_DB=${CELERY_REDIS_BROKER_DB:-0}
      - CELERY_REDIS_BACKEND_DB=${CELERY_REDIS_BACKEND_DB:-1}
      - LLMCTL_RAG_CELERY_BROKER_URL=redis://${CELERY_REDIS_HOST:-192.168.1.36}:${CELERY_REDIS_PORT:-6380}/${CELERY_REDIS_BROKER_DB:-0}
      - LLMCTL_RAG_CELERY_RESULT_BACKEND=redis://${CELERY_REDIS_HOST:-192.168.1.36}:${CELERY_REDIS_PORT:-6380}/${CELERY_REDIS_BACKEND_DB:-1}
    dns:
      - 192.168.1.1
      - 1.1.1.1
      - 8.8.8.8
    ports:
      - "5050:5050"
    volumes:
      - ../app/llmctl-rag:/app/app/llmctl-rag
      - llmctl_rag_data:/data/llmctl-rag
      - ../example:/example:ro
    depends_on:
      - chromadb
    restart: unless-stopped
  llmctl-studio:
    image: llmctl-studio:latest
    container_name: llmctl-studio
    environment:
      - CELERY_REDIS_HOST=192.168.1.36
      - CELERY_REDIS_PORT=6380
      - CELERY_REDIS_BROKER_DB=0
      - CELERY_REDIS_BACKEND_DB=1
    dns:
      - 192.168.1.1
      - 1.1.1.1
      - 8.8.8.8
    ports:
      - "5055:5055"
    volumes:
      - ../app/llmctl-studio/run.py:/app/app/llmctl-studio/run.py
      - ../app/llmctl-studio/src:/app/app/llmctl-studio/src
      - ../data:/app/data
      - ${HOME}/.gitconfig:/home/llmctl-studio/.gitconfig:ro
      - /var/run/docker.sock:/var/run/docker.sock
  dozzle:
    image: amir20/dozzle:latest
    container_name: dozzle
    environment:
      - DOZZLE_NO_ANALYTICS=true
    ports:
      - "18080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    restart: unless-stopped
volumes:
  chroma_data:
  llmctl_rag_data:
