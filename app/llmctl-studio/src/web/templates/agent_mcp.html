{% extends "agent_detail_layout.html" %}

{% block agent_detail_content %}
<section class="card">
  <div class="card-header">
    <h2 class="section-title">Add MCP Server</h2>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Attach MCP servers for runtime tools. They are not included in the prompt.
  </p>
  <form
    method="post"
    action="{{ url_for('agents.add_agent_mcp_server', agent_id=agent.id) }}"
    class="form-grid"
    style="margin-top: 20px;"
  >
    <input type="hidden" name="next" value="{{ request.path }}" />
    <label class="label">
      mcp server
      <select name="mcp_server_id" class="input">
        <option value="">Select MCP server</option>
        {% for mcp in available_mcp_servers %}
          <option value="{{ mcp.id }}">{{ mcp.name }}</option>
        {% endfor %}
      </select>
      {% if not available_mcp_servers %}
        <span class="muted" style="font-size: 12px; margin-top: 6px;">
          No available MCP servers to attach.
        </span>
      {% endif %}
    </label>
    <div class="form-actions">
      <button type="submit" class="btn btn-secondary">
        <i class="fa-solid fa-plus"></i>
        add server
      </button>
    </div>
  </form>
</section>

<section class="card">
  <div class="card-header">
    <h2 class="section-title">MCP Servers</h2>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Attached MCP servers used for tooling.
  </p>
  {% if agent.mcp_servers %}
    <div style="margin-top: 20px; overflow-x: auto;">
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Key</th>
            <th>Description</th>
            <th class="table-actions-cell"><i class="fa-solid fa-trash" aria-hidden="true"></i></th>
          </tr>
        </thead>
        <tbody>
          {% for mcp in agent.mcp_servers %}
            <tr>
              <td>{{ mcp.name }}</td>
              <td class="muted">{{ mcp.server_key }}</td>
              <td class="muted">{{ mcp.description or "-" }}</td>
              <td class="table-actions-cell">
                <form
                  method="post"
                  action="{{ url_for('agents.remove_agent_mcp_server', agent_id=agent.id, mcp_id=mcp.id) }}"
                  onsubmit="return confirm('Remove this MCP server?');"
                >
                  <input type="hidden" name="next" value="{{ request.path }}" />
                  <button type="submit" class="btn btn-danger" aria-label="Remove MCP server">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted" style="margin-top: 16px;">No MCP servers attached.</p>
  {% endif %}
</section>
{% endblock %}
