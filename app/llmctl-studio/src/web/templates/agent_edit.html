{% extends "base.html" %}

{% block topbar_actions %}
  <a class="btn btn-secondary" href="{{ url_for('agents.view_agent', agent_id=agent.id) }}">
    <i class="fa-solid fa-arrow-left"></i>
    back to agent
  </a>
  <a class="btn btn-secondary" href="{{ url_for('agents.list_agents') }}">
    <i class="fa-solid fa-list"></i>
    all agents
  </a>
{% endblock %}

{% block content %}
<section class="card">
  <div class="card-header">
    <div>
      <p class="eyebrow">agent {{ agent.id }}</p>
      <h2 class="section-title">Edit Agent</h2>
    </div>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Update the agent description, role, and runtime configuration.
  </p>
  <form
    method="post"
    action="{{ url_for('agents.update_agent', agent_id=agent.id) }}"
    class="form-grid"
    style="margin-top: 20px;"
  >
    <label class="label">
      name (optional)
      <input type="text" name="name" value="{{ agent.name }}" class="input" />
    </label>
    <label class="label">
      description
      <textarea name="description" class="textarea" required>{{ agent.description or "" }}</textarea>
    </label>
    <label class="label">
      role (optional)
      <select name="role_id" class="input">
        <option value="">No role</option>
        {% for role in roles %}
          <option
            value="{{ role.id }}"
            {% if agent.role_id == role.id %}selected{% endif %}
          >
            {{ role.name }}
          </option>
        {% endfor %}
      </select>
      {% if not roles %}
        <span class="muted" style="font-size: 12px; margin-top: 6px;">
          Create a role in
          <a href="{{ url_for('agents.list_roles') }}" style="text-decoration: underline;">
            roles
          </a>
          to reuse shared prompts.
        </span>
      {% endif %}
    </label>
    <label class="label">
      model (optional)
      <select name="model_id" class="input">
        <option value="">No model (use default model/provider)</option>
        {% for model in models %}
          <option
            value="{{ model.id }}"
            {% if agent.model_id == model.id %}selected{% endif %}
          >
            {{ model.name }}
          </option>
        {% endfor %}
      </select>
      {% if not models %}
        <span class="muted" style="font-size: 12px; margin-top: 6px;">
          Create a model in
          <a href="{{ url_for('agents.list_models') }}" style="text-decoration: underline;">
            models
          </a>
          to attach provider configuration.
        </span>
      {% endif %}
    </label>
    <div class="label" style="grid-column: 1 / -1;">
      scripts (optional)
      {% include "partials/script_picker.html" %}
    </div>
    <p class="muted" style="margin-top: 4px; font-size: 12px;">
      Manage MCP servers from the agent detail page.
    </p>
    <label class="label">
      autoprompt (autorun loop)
      <textarea name="autonomous_prompt" class="textarea">{{ agent.autonomous_prompt or "" }}</textarea>
    </label>
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <i class="fa-solid fa-floppy-disk"></i>
        save
      </button>
      <a class="btn btn-secondary" href="{{ url_for('agents.view_agent', agent_id=agent.id) }}">
        <i class="fa-solid fa-arrow-left"></i>
        cancel
      </a>
    </div>
  </form>
</section>
{% endblock %}
