{% extends "settings_layout.html" %}

{% block settings_content %}
<section class="card">
  <div class="card-header">
    <h2 class="section-title">Runtime Hints</h2>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Expectations for polling, revocation, and provider defaults.
  </p>
  <div class="grid grid-3" style="margin-top: 20px;">
    <div class="subcard">
      <p class="eyebrow">polling</p>
      <p style="margin-top: 8px;">
        Agents check in every {{ config.AGENT_POLL_SECONDS }} seconds.
      </p>
    </div>
    <div class="subcard">
      <p class="eyebrow">revocation</p>
      <p style="margin-top: 8px;">
        Revoke on stop is
        {{ "enabled" if config.CELERY_REVOKE_ON_STOP else "disabled" }}.
      </p>
    </div>
    <div class="subcard">
      <p class="eyebrow">provider</p>
      <p style="margin-top: 8px;">
        {% if llm_config.provider %}
          Using {{ llm_config.label }} via {{ llm_config.command }} (model {{ llm_config.model }}).
        {% else %}
          No default provider configured. Agents use the default model if set.
        {% endif %}
      </p>
    </div>
  </div>
</section>

<section class="card" style="margin-top: 16px;">
  <div class="card-header">
    <h2 class="section-title">Instruction Adapter Flags</h2>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Native file materialization and prompt-envelope fallback policy per provider.
  </p>
  <form method="post" action="{{ url_for('agents.update_instruction_runtime_settings_route') }}" style="margin-top: 16px;">
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th>Provider</th>
            <th>Native mode</th>
            <th>Fallback mode</th>
          </tr>
        </thead>
        <tbody>
          {% for row in instruction_runtime_flags %}
            <tr>
              <td>{{ row.label }}</td>
              <td>
                <label style="display: inline-flex; gap: 8px; align-items: center;">
                  <input
                    type="checkbox"
                    name="{{ row.native_key }}"
                    value="true"
                    {% if row.native_enabled %}checked{% endif %}
                    {% if not row.supports_native %}disabled{% endif %}
                  />
                  enabled
                </label>
              </td>
              <td>
                <label style="display: inline-flex; gap: 8px; align-items: center;">
                  <input
                    type="checkbox"
                    name="{{ row.fallback_key }}"
                    value="true"
                    {% if row.fallback_enabled %}checked{% endif %}
                  />
                  enabled
                </label>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <button type="submit" class="btn btn-secondary" style="margin-top: 12px;">
      <i class="fa-solid fa-floppy-disk"></i>
      save instruction adapter flags
    </button>
  </form>
</section>

{% endblock %}
