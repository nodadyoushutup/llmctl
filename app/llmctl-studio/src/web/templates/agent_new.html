{% extends "base.html" %}

{% block topbar_actions %}
  <a class="btn btn-secondary" href="{{ url_for('agents.list_agents') }}">
    <i class="fa-solid fa-arrow-left"></i>
    all agents
  </a>
{% endblock %}

{% block content %}
<section class="card">
  <div class="card-header">
    <h2 class="section-title">Create Agent</h2>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Define the agent description, role, and scripts.
  </p>
  <form method="post" action="{{ url_for('agents.create_agent') }}" class="form-grid">
    <label class="label">
      name (optional)
      <input type="text" name="name" placeholder="Agent name" class="input" />
    </label>
    <label class="label">
      description
      <textarea
        name="description"
        placeholder="Describe the agent's focus and responsibilities."
        required
        class="textarea"
      ></textarea>
    </label>
    <label class="label">
      role (optional)
      <select name="role_id" class="input">
        <option value="">No role</option>
        {% for role in roles %}
          <option value="{{ role.id }}">{{ role.name }}</option>
        {% endfor %}
      </select>
      {% if not roles %}
        <span class="muted" style="font-size: 12px; margin-top: 6px;">
          Create a role in
          <a href="{{ url_for('agents.list_roles') }}" style="text-decoration: underline;">
            roles
          </a>
          to reuse shared prompts.
        </span>
      {% endif %}
    </label>
    <label class="label">
      model (optional)
      <select name="model_id" class="input">
        <option value="">No model (use default model/provider)</option>
        {% for model in models %}
          <option value="{{ model.id }}">{{ model.name }}</option>
        {% endfor %}
      </select>
      {% if not models %}
        <span class="muted" style="font-size: 12px; margin-top: 6px;">
          Create a model in
          <a href="{{ url_for('agents.list_models') }}" style="text-decoration: underline;">
            models
          </a>
          to attach provider configuration.
        </span>
      {% endif %}
    </label>
    <div class="label" style="grid-column: 1 / -1;">
      scripts (optional)
      {% include "partials/script_picker.html" %}
    </div>
    <p class="muted" style="margin-top: 4px; font-size: 12px;">
      You can attach MCP servers after creating the agent.
    </p>
    <label class="label">
      autoprompt (autorun loop)
      <textarea
        name="autonomous_prompt"
        placeholder="Take the next planning step and execute it."
        class="textarea"
      ></textarea>
    </label>
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <i class="fa-solid fa-plus"></i>
        create
      </button>
      <button type="reset" class="btn btn-secondary">
        <i class="fa-solid fa-rotate-right"></i>
        reset
      </button>
    </div>
  </form>
</section>
{% endblock %}
