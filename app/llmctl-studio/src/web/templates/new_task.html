{% extends "base.html" %}

{% block content %}
<section class="card">
  <div class="card-header">
    <h2 class="section-title">Create Task</h2>
  </div>
  <p class="muted" style="margin-top: 12px;">
    Queue a single run and trigger the celery worker.
  </p>
  <form method="post" action="{{ url_for('agents.create_task') }}" class="form-grid" enctype="multipart/form-data">
    <label class="label">
      agent
      <select name="agent_id" class="input">
        <option value="">Select agent</option>
        {% for agent in agents %}
          <option value="{{ agent.id }}">{{ agent.name }}</option>
        {% endfor %}
      </select>
      {% if not agents %}
        <span class="muted" style="font-size: 12px; margin-top: 6px;">
          Create an agent first to queue a task.
        </span>
      {% endif %}
    </label>
    <div class="label" style="grid-column: 1 / -1;">
      scripts (optional)
      {% include "partials/script_picker.html" %}
    </div>
    <label class="label" style="grid-column: 1 / -1;">
      prompt
      <textarea
        name="prompt"
        placeholder="Write the task prompt."
        class="textarea"
        data-attachment-paste
        data-attachment-input-id="task-attachments"
      ></textarea>
    </label>
    <label class="label" style="grid-column: 1 / -1;">
      attachments (optional)
      <input
        type="file"
        name="attachments"
        id="task-attachments"
        class="input"
        multiple
        data-attachment-input
      />
      <span class="muted" style="font-size: 12px; margin-top: 6px;">
        Paste images into the prompt or choose files. Saved to <code>data/attachments</code>.
      </span>
      <div class="muted" style="font-size: 12px; margin-top: 6px;" data-attachment-list="task-attachments"></div>
    </label>
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <i class="fa-solid fa-paper-plane"></i>
        queue task
      </button>
      <a class="btn btn-secondary" href="{{ url_for('agents.list_tasks') }}">
        <i class="fa-solid fa-arrow-left"></i>
        back to tasks
      </a>
    </div>
  </form>
</section>
{% endblock %}
