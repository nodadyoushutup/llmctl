{% extends "base.html" %}

{% block topbar_actions %}
  <a class="btn btn-secondary" href="{{ url_for('agents.list_task_templates') }}">
    <i class="fa-solid fa-arrow-left"></i>
    back to tasks
  </a>
{% endblock %}

{% block action_header %}
  <div class="action-header-actions">
    <a class="btn btn-secondary" href="{{ url_for('agents.edit_task_template', template_id=template.id) }}">
      <i class="fa-solid fa-pen-to-square"></i>
      edit
    </a>
    <form
      method="post"
      action="{{ url_for('agents.delete_task_template', template_id=template.id) }}"
      onsubmit="return confirm('Delete this task?');"
    >
      <input
        type="hidden"
        name="next"
        value="{{ url_for('agents.list_task_templates') }}"
      />
      <button type="submit" class="btn btn-danger">
        <i class="fa-solid fa-trash"></i>
        delete
      </button>
    </form>
  </div>
{% endblock %}

{% block content %}
<section class="card">
  <div class="card-header">
    <div>
      <p class="eyebrow">task {{ template.id }}</p>
      <h2 class="section-title">{{ template.name }}</h2>
    </div>
  </div>
  <div class="grid grid-2" style="margin-top: 20px;">
    <div class="subcard">
      <p class="eyebrow">details</p>
      <div class="stack" style="margin-top: 12px; font-size: 12px;">
        <p class="muted">
          Agent: {{ agents_by_id.get(template.agent_id, "Unassigned") }}
        </p>
        <p class="muted">Description: {{ template.description or "-" }}</p>
        <p class="muted">Created: {{ human_time(template.created_at) }}</p>
        <p class="muted">Updated: {{ human_time(template.updated_at) }}</p>
        <p class="muted">Node runs: {{ task_count }}</p>
        {% if template.attachments %}
          <p class="muted">Attachments:</p>
          {% for attachment in template.attachments %}
            <p class="muted">
              {{ attachment.file_name }} {% if attachment.file_path %}({{ attachment.file_path }}){% endif %}
            </p>
          {% endfor %}
        {% else %}
          <p class="muted">Attachments: -</p>
        {% endif %}
      </div>
    </div>
    <div class="subcard">
      <p class="eyebrow">prompt</p>
      <pre style="margin-top: 12px; white-space: pre-wrap;">{{ template.prompt }}</pre>
    </div>
  </div>
</section>
{% endblock %}
