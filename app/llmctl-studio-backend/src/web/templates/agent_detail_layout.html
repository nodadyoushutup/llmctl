{% extends "base.html" %}

{% block topbar_actions %}
  <a class="btn btn-secondary" href="{{ url_for('agents.list_agents') }}">
    <i class="fa-solid fa-arrow-left"></i>
    all agents
  </a>
{% endblock %}

{% block content %}
<section class="card">
  <div class="card-header agent-hero-header">
    <div class="agent-hero-title">
      <p class="eyebrow">agent {{ agent.id }}</p>
      <h2 class="section-title">{{ agent.name }}</h2>
      {% if agent.description %}
        <p class="muted" style="margin-top: 8px; font-size: 12px;">
          {{ agent.description }}
        </p>
      {% endif %}
      <div class="row agent-hero-badges">
        {% if agent_status in ["running", "starting"] %}
          <span class="status status-running">autorun on</span>
        {% elif agent_status == "stopping" %}
          <span class="status status-warning">autorun stopping</span>
        {% elif agent_status == "error" %}
          <span class="status status-failed">autorun error</span>
        {% else %}
          <span class="status status-idle">autorun off</span>
        {% endif %}
      </div>
    </div>
    <div class="row agent-hero-actions">
      {% set agent_active = agent_status in ["starting", "running", "stopping"] %}
      <a class="btn btn-secondary" href="{{ url_for('agents.edit_agent', agent_id=agent.id) }}">
        <i class="fa-solid fa-pen-to-square"></i>
        edit
      </a>
      {% if agent_active %}
        <form method="post" action="{{ url_for('agents.stop_agent', agent_id=agent.id) }}">
          <input type="hidden" name="next" value="{{ request.path }}" />
          <button type="submit" class="btn btn-danger">
            <i class="fa-solid fa-stop"></i>
            disable autorun
          </button>
        </form>
      {% else %}
        <form method="post" action="{{ url_for('agents.start_agent', agent_id=agent.id) }}">
          <input type="hidden" name="next" value="{{ request.path }}" />
          <button type="submit" class="btn btn-primary">
            <i class="fa-solid fa-play"></i>
            enable autorun
          </button>
        </form>
      {% endif %}
    </div>
  </div>
  <dl class="meta-list meta-list-compact" style="margin-top: 16px;">
    <div class="meta-span">
      <dt>Role</dt>
      <dd>
        {% if agent.role_id %}
          <a href="{{ url_for('agents.view_role', role_id=agent.role_id) }}">
            {{ roles_by_id.get(agent.role_id, "Role " ~ agent.role_id) }}
          </a>
        {% else %}
          -
        {% endif %}
      </dd>
    </div>
    <div class="meta-span">
      <dt>Created</dt>
      <dd>{{ human_time(agent.created_at) }}</dd>
    </div>
    <div class="meta-span">
      <dt>Updated</dt>
      <dd>{{ human_time(agent.updated_at) }}</dd>
    </div>
    <div>
      <dt>Utility ownership</dt>
      <dd>Agent-level</dd>
    </div>
  </dl>
</section>

{% block agent_detail_content %}{% endblock %}
{% endblock %}
